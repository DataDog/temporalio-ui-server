import{B as w,g as h,t as x,h as C}from"./route-for.22236b84.js";import{w as q}from"./index.169c571c.js";import{t as F}from"./toaster.7027624d.js";import{h as g}from"./has.b58a7bba.js";import{i as R}from"./is-network-error.c3fa23ce.js";import{i as W}from"./persist-store.fdee4674.js";import{W as O}from"./index.c37b9eda.js";import{b as P}from"./paths.64822c04.js";import{p as N}from"./stores.00c227c2.js";const S=q(null);function _(c=w){const n="",s=!n.startsWith("http");let o="";return s?o=c?window.location.origin+n:"":o=n,o.endsWith("/")&&(o=o.slice(0,-1)),o}const z=(c,n=F,s=S,o=w)=>{throw typeof c=="string"?n.push({variant:"error",message:c}):c.report=!1,c instanceof Error&&n.push({variant:"error",message:c.message}),v(c)&&o&&window.location.assign(h(c==null?void 0:c.message)),b(c)&&o&&window.location.assign(h(c==null?void 0:c.message)),R(c)&&(n.push({variant:"error",message:`${c.statusCode} ${c.statusText}`}),s.set(c)),c},cn=(c,n=w)=>{var o;const s=`${c==null?void 0:c.status} ${(o=c==null?void 0:c.body)==null?void 0:o.message}`;if(v(c)&&n){window.location.assign(h(s));return}if(b(c)&&n){window.location.assign(h(s));return}},v=c=>e(c,401),b=c=>e(c,403),e=(c,n)=>g(c,"statusCode")?c.statusCode===n:g(c,"status")?c.status===n:!1,sn=c=>(c==null?void 0:c.message)!==void 0&&typeof(c==null?void 0:c.message)=="string",on=async(c,n={})=>{const{params:s={},request:o=fetch,token:i,notifyOnError:l=!0,handleError:f=z,onError:$,isBrowser:k=w}=n;let{options:t}=n;const y=i?{next_page_token:i}:{},U=new URLSearchParams({...s,...y}),T=x(c,U);try{t=L(t,k),t=await B(t,k);const u=await o(T,t),d=await u.json(),{status:E,statusText:A}=u;if(!u.ok)if($&&W($))$({status:E,statusText:A,body:d});else throw{statusCode:u.status,statusText:u.statusText,response:u,message:(d==null?void 0:d.message)??u.statusText};return d}catch(u){if(l)f(u);else throw u}},L=(c,n=w)=>{const s={credentials:"include",...c};return s.headers=K(c==null?void 0:c.headers,n),s},B=async(c,n=w)=>{const s=C();if(s){const{accessToken:o,idToken:i}=s;c.headers=await I(c==null?void 0:c.headers,async()=>o??i,n),c.headers=H(c==null?void 0:c.headers,i,n)}else globalThis!=null&&globalThis.AccessToken&&(c.headers=await I(c==null?void 0:c.headers,globalThis.AccessToken,n));return c},I=async(c,n,s=w)=>{if(c||(c={}),!s)return c;try{const o=await n();o&&(c.Authorization=`Bearer ${o}`)}catch(o){console.error(o)}return c},H=(c={},n,s=w)=>(s&&n&&(c["Authorization-Extras"]=n),c),K=(c,n=w)=>{if(c||(c={}),!n)return c;const s="_csrf=",o="X-CSRF-TOKEN";try{let l=document.cookie.split(";").find(f=>f.includes(s));l&&!c[o]&&(l=l.trim().slice(s.length),c[o]=l)}catch(i){console.error(i)}return c},X=(c,n)=>c?c.replace("%namespace%",n):"",D=c=>{var l,f;let n="";const s=(l=O(N).data)==null?void 0:l.webUrl,o=s&&c,i=((f=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:f.apiUrl)&&c;return o?n=s:i?(console.warn("Using fallback api url, web url not found"),n=X(globalThis.AppConfig.apiUrl,c)):n=_(),n.endsWith("/")&&(n=n.slice(0,-1)),n=`${n}${P}`,n},G=c=>(c.startsWith("/")&&(c=c.slice(1)),`/api/v1/${c}`),J=(c,n)=>`${D(n)}${c}`,M=c=>Object.keys(c??{}).reduce((n,s)=>(n[s]=encodeURIComponent(encodeURIComponent(c[s])),n),{namespace:"",workflowId:"",scheduleId:"",runId:"",queue:"",activityId:""});function Q(c,n,s=!0){s&&(n=M(n));const o={cluster:"/cluster","events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events/reverse`,namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/query`,"schedule.delete":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,"search-attributes":`/namespaces/${n.namespace}/search-attributes`,settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,user:"/me","workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/terminate`,"workflow.cancel":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/cancel`,"workflow.signal":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/signal`,"workflow.reset":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/reset`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/workflows/archived`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflows/count`,"activity.complete":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/activities/${n.activityId}/complete`,"activity.fail":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/activities/${n.activityId}/fail`,"batch-operations":`/namespaces/${n.namespace}/batch-operations`,"batch-operation.describe":`/namespaces/${n.namespace}/batch-operations/describe`};return G(o[c])}function un(c,n,s=!0){const o=Q(c,n,s);return J(o,n==null?void 0:n.namespace)}export{on as a,D as b,cn as c,b as d,sn as e,_ as g,z as h,v as i,S as n,Q as p,un as r};
