import{S as $,b as C,a as k,m as w,c as F,C as I,p as N,d as T,D as U,u as g,f as y,E as x,T as A,j as B,g as j,k as b,F as G,K as h,w as H,x as J}from"./index.c37b9eda.js";import{a as O,e as q}from"./route-for.22236b84.js";import{g as D}from"./navigation.450135e2.js";import{B as K}from"./button.eb68e3f0.js";import{t as L}from"./index.95dab8a0.js";import{t as S}from"./toaster.7027624d.js";import{i as P,a as R}from"./import-events.2a38decc.js";import{p as W}from"./parse-with-big-int.02af2f95.js";import{g as z}from"./index.12ac8713.js";import{p as M}from"./stores.00c227c2.js";import{l as Q}from"./namespaces.3676122a.js";function V(r){let s;return{c(){s=H("Import")},l(e){s=J(e,"Import")},m(e,o){y(e,s,o)},d(e){e&&b(s)}}}function X(r){let s,e,o,c,p,a;return o=new K({props:{icon:"file-upload",disabled:!r[0],$$slots:{default:[V]},$$scope:{ctx:r}}}),o.$on("click",r[2]),{c(){s=w("input"),e=F(),I(o.$$.fragment),this.h()},l(t){s=N(t,"INPUT",{class:!0,type:!0,accept:!0}),e=T(t),U(o.$$.fragment,t),this.h()},h(){g(s,"class","import-input block rounded-md border border-gray-200 p-2"),g(s,"type","file"),g(s,"accept",".json")},m(t,i){y(t,s,i),y(t,e,i),x(o,t,i),c=!0,p||(a=A(s,"change",r[1]),p=!0)},p(t,[i]){const f={};i&1&&(f.disabled=!t[0]),i&128&&(f.$$scope={dirty:i,ctx:t}),o.$set(f)},i(t){c||(B(o.$$.fragment,t),c=!0)},o(t){j(o.$$.fragment,t),c=!1},d(t){t&&b(s),t&&b(e),G(o,t),p=!1,a()}}}function Y(r,s,e){let o,c,p;h(r,Q,n=>e(4,o=n)),h(r,O,n=>e(5,c=n)),h(r,M,n=>e(6,p=n));let a,t=!1;return[t,async n=>{var l;const m=n.target,d=(l=m==null?void 0:m.files)===null||l===void 0?void 0:l[0],u=new FileReader;d&&(u.readAsText(d),u.onload=()=>{var _,v;try{const E=(v=(_=u==null?void 0:u.result)===null||_===void 0?void 0:_.toString())!==null&&v!==void 0?v:"";a=W(E),e(0,t=!0)}catch{S.push({variant:"error",message:"Could not parse JSON"}),e(0,t=!1)}})},async()=>{const{settings:n}=p.data;try{const l=await L({response:Array.isArray(a)?a:a==null?void 0:a.events,namespace:o,settings:n,accessToken:c.accessToken}),m=z(l);P.set(l),R.set(m),e(0,t=!1);const d=q(o,"feed");D(d)}catch(l){console.error(l),S.push({variant:"error",message:"Could not create event history from JSON"})}}]}class pt extends ${constructor(s){super(),C(this,s,Y,X,k,{})}}export{pt as E};
