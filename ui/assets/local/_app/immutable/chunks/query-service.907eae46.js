import{p as f}from"./data-encoder-config.3c4a34eb.js";import{c as m}from"./decode-payload.8339b61c.js";import{g as l,a as h}from"./get-codec.b31847a3.js";import{h as T}from"./has.0120f47d.js";import{s as u,p as _}from"./parse-with-big-int.0036a80a.js";import{r as g,a as A,e as I}from"./route-for-api.5de7e4eb.js";const b=t=>{const e=t.indexOf("["),a=t.indexOf("]");return t.slice(e+1,a).split(" ").filter(r=>r!=="__stack_trace").map(r=>r.endsWith(",")?r.slice(0,r.length-1):r)},O=async(t,e)=>(e=await e,{namespace:t,workflowId:e.id,runId:e.runId});async function d({workflow:t,namespace:e,queryType:a},r=fetch,n){t=await t;const o=await O(e,t),s=g("query",o);return await A(s,{options:{method:"POST",body:u({execution:{workflowId:t.id,runId:t.runId},query:{queryType:a}})},request:r,onError:n,notifyOnError:!1})}async function E(t,e=fetch){return new Promise((a,r)=>{d({...t,queryType:"@@temporal-internal__list"},e,n=>{I(n.body)&&n.body.message.includes("@@temporal-internal__list")?a(b(n.body.message)):r(n)})})}async function P(t,e,a,r=fetch){return d(t,r).then(async n=>{const{queryResult:o}=n??{queryResult:{payloads:[]}};let s=o.payloads;try{if(s[0]){const i=l(e),y=h(e,f),p={...e,codec:{...e==null?void 0:e.codec,endpoint:i,passAccessToken:y}},c=await m({attributes:o,namespace:t.namespace,settings:p,accessToken:a});T(c,"payloads")&&Array.isArray(c.payloads)&&(s=c.payloads[0])}return _(s)}catch{return typeof s!="string"?u(s):s}})}async function Q(t,e,a){return P({...t,queryType:"__stack_trace"},e,a)}export{P as a,Q as b,E as g};
