import{p as f}from"./is-http.b6c22717.js";import{c as m,a as l}from"./decode-payload.9b06cab2.js";import{g as h,a as T}from"./get-codec.69981907.js";import{h as _}from"./has.b58a7bba.js";import{s as d,p as g}from"./parse-with-big-int.02af2f95.js";import{r as A,a as I,e as b}from"./route-for-api.e3a9ee2e.js";const P=t=>{const e=t.indexOf("["),r=t.indexOf("]");return t.slice(e+1,r).split(" ").filter(a=>a!=="__stack_trace").map(a=>a.endsWith(",")?a.slice(0,a.length-1):a)},O=async(t,e)=>(e=await e,{namespace:t,workflowId:e.id,runId:e.runId});async function u({workflow:t,namespace:e,queryType:r},a=fetch,s){t=await t;const o=await O(e,t),n=A("query",o);return await I(n,{options:{method:"POST",body:d({execution:{workflowId:t.id,runId:t.runId},query:{queryType:r}})},request:a,onError:s,notifyOnError:!1})}async function Q(t,e=fetch){return new Promise((r,a)=>{u({...t,queryType:"@@temporal-internal__list"},e,s=>{b(s.body)&&s.body.message.includes("@@temporal-internal__list")?r(P(s.body.message)):a(s)})})}async function W(t,e,r,a=fetch){return u(t,a).then(async s=>{const{queryResult:o}=s??{queryResult:{payloads:[]}};let n=o.payloads;try{if(n[0]){const c=h(e),y=T(e,f),p={...e,codec:{...e==null?void 0:e.codec,endpoint:c,passAccessToken:y}},i=c?await m({attributes:o,namespace:t.namespace,settings:p,accessToken:r}):await l(o);_(i,"payloads")&&Array.isArray(i.payloads)&&(n=i.payloads[0])}return g(n)}catch{return typeof n!="string"?d(n):n}})}async function v(t,e,r){return W({...t,queryType:"__stack_trace"},e,r)}export{W as a,v as b,Q as g};
