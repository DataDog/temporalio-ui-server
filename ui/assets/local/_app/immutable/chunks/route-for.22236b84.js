import{b as s}from"./paths.64822c04.js";import{W as w}from"./index.c37b9eda.js";import{p as f}from"./persist-store.fdee4674.js";const $=!0;var l=(e=>(e.AuthorizationCode="authorization-code",e.Implicit="implicit",e))(l||{});const g=f("AuthUser",{}),A=()=>w(g),k=(e,r)=>{const{accessToken:t,idToken:o,name:a,email:n,picture:c}=e;switch(r){case l.AuthorizationCode:if(!t)throw new Error("No access token");break;case l.Implicit:if(!o)throw new Error("No id token");break}g.set({accessToken:t,idToken:o,name:a,email:n,picture:c})},E=()=>{g.set({})};class i extends Error{}i.prototype.name="InvalidTokenError";function U(e){return decodeURIComponent(atob(e).replace(/(.)/g,(r,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function F(e){let r=e.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return U(r)}catch{return atob(r)}}function I(e,r){if(typeof e!="string")throw new i("Invalid token specified: must be a string");r||(r={});const t=r.header===!0?0:1,o=e.split(".")[t];if(typeof o!="string")throw new i(`Invalid token specified: missing part #${t+1}`);let a;try{a=F(o)}catch(n){throw new i(`Invalid token specified: invalid base64 for part #${t+1} (${n.message})`)}try{return JSON.parse(a)}catch(n){throw new i(`Invalid token specified: invalid json for part #${t+1} (${n.message})`)}}function p(e){return e&&e.replace(/%/g,"%25").replace(/,/g,"%2C").replace(/\//g,"%2F").replace(/\\/g,"%5C").replace(/\?/g,"%3F").replace(/:/g,"%3A").replace(/@/g,"%40").replace(/&/g,"%26").replace(/=/g,"%3D").replace(/\+/g,"%2B").replace(/\$/g,"%24").replace(/#/g,"%23")}function L(e){return e&&e.replace(/%2C/g,",").replace(/%2F/g,"/").replace(/%5C/g,"\\").replace(/%3F/g,"?").replace(/%3A/g,":").replace(/%40/g,"@").replace(/%26/g,"&").replace(/%3D/g,"=").replace(/%2B/g,"+").replace(/%24/g,"$").replace(/%23/g,"#").replace(/%25/g,"%")}const S=(e,r)=>{const t=r instanceof URLSearchParams;return r&&!t&&(r=new URLSearchParams(r)),r?`${e}?${r}`:e},_=()=>`${s}/namespaces`,d=({namespace:e})=>`${s}/namespaces/${e}`,z=()=>`${s}/select-namespace`,v=e=>`${d(e)}/workflows`,D=e=>`${d(e)}/archival`,u=({workflow:e,run:r,...t})=>{const o=p(e);return`${v(t)}/${o}/${r}`},m=e=>`${d(e)}/schedules`,N=({namespace:e})=>`${m({namespace:e})}/create`,T=({scheduleId:e,namespace:r})=>{const t=p(e);return`${m({namespace:r})}/${t}`},W=({scheduleId:e,namespace:r})=>{const t=p(e);return`${m({namespace:r})}/${t}/edit`},q=({queryParams:e,...r})=>{const t=`${u(r)}/history`;return S(`${t}`,e)},j=e=>`${u(e)}/workers`,x=e=>{const r=p(e.queue);return`${d({namespace:e.namespace})}/task-queues/${r}`},B=e=>`${u(e)}/stack-trace`,O=e=>`${u(e)}/query`,H=e=>`${u(e)}/pending-activities`,Q=e=>{const{settings:r,searchParams:t,originUrl:o}=e;switch(r.auth.flow){case l.AuthorizationCode:return P(r,t,o);case l.Implicit:return b(r)}},P=(e,r,t)=>{const o=new URL(`${s}/auth/sso`,e.baseUrl);let a=e.auth.options??[];return a=[...a,"returnUrl"],a.forEach(n=>{if(!r)return;const c=r.get(n);c&&o.searchParams.set(n,c)}),!o.searchParams.get("returnUrl")&&t&&o.searchParams.set("returnUrl",t),o.toString()},b=e=>{const r=new URL(e.auth.authorizationUrl);r.searchParams.set("response_type","id_token"),r.searchParams.set("client_id",e.auth.clientId),r.searchParams.set("redirect_uri",e.auth.callbackUrl),r.searchParams.set("scope",e.auth.scopes.join(" "));const t=crypto.randomUUID();window.localStorage.setItem("nonce",t),r.searchParams.set("nonce",t);const o=crypto.randomUUID();return sessionStorage.setItem(o,new URLSearchParams(window.location.search).get("returnUrl")??"/"),r.searchParams.set("state",o),r.toString()};class h extends Error{}const J=()=>{const e=new URLSearchParams(window.location.hash.substring(1)),r=e.get("id_token");if(!r)throw new h("No id_token in hash");const t=window.localStorage.getItem("nonce");if(window.localStorage.removeItem("nonce"),!t)throw new h("No nonce in localStorage");let o;try{o=I(r)}catch(c){throw c instanceof i?new h("Invalid id_token in hash"):new h(c)}const a=e.get("state"),n=new URL((a?sessionStorage.getItem(a):null)??"/");return sessionStorage.removeItem("state"),k({idToken:r,name:o.name,email:o.email},l.Implicit),n.toString()},G=(e="",r=$)=>{if(r){const t=new URL(`${s}/login`,window.location.origin);return t.searchParams.set("returnUrl",window.location.href),e&&t.searchParams.set("error",e),t.toString()}return`${s}/login`},K=(e,r)=>e&&r?`${s}/import/events/${e}/workflow/run/history/${r}`:`${s}/import/events`;export{$ as B,l as O,g as a,D as b,_ as c,m as d,K as e,E as f,G as g,A as h,J as i,h as j,q as k,j as l,H as m,B as n,O as o,L as p,z as q,v as r,k as s,S as t,x as u,d as v,T as w,N as x,W as y,Q as z};
