import{b as s}from"./paths.5f1e6284.js";const w=!0;var d=(e=>(e.AuthorizationCode="authorization-code",e.Implicit="implicit",e))(d||{});class c extends Error{}c.prototype.name="InvalidTokenError";function $(e){return decodeURIComponent(atob(e).replace(/(.)/g,(r,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function k(e){let r=e.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return $(r)}catch{return atob(r)}}function F(e,r){if(typeof e!="string")throw new c("Invalid token specified: must be a string");r||(r={});const t=r.header===!0?0:1,o=e.split(".")[t];if(typeof o!="string")throw new c(`Invalid token specified: missing part #${t+1}`);let a;try{a=k(o)}catch(n){throw new c(`Invalid token specified: invalid base64 for part #${t+1} (${n.message})`)}try{return JSON.parse(a)}catch(n){throw new c(`Invalid token specified: invalid json for part #${t+1} (${n.message})`)}}function h(e){return e&&e.replace(/%/g,"%25").replace(/,/g,"%2C").replace(/\//g,"%2F").replace(/\\/g,"%5C").replace(/\?/g,"%3F").replace(/:/g,"%3A").replace(/@/g,"%40").replace(/&/g,"%26").replace(/=/g,"%3D").replace(/\+/g,"%2B").replace(/\$/g,"%24").replace(/#/g,"%23")}function y(e){return e&&e.replace(/%2C/g,",").replace(/%2F/g,"/").replace(/%5C/g,"\\").replace(/%3F/g,"?").replace(/%3A/g,":").replace(/%40/g,"@").replace(/%26/g,"&").replace(/%3D/g,"=").replace(/%2B/g,"+").replace(/%24/g,"$").replace(/%23/g,"#").replace(/%25/g,"%")}const I=(e,r)=>{const t=r instanceof URLSearchParams;return r&&!t&&(r=new URLSearchParams(r)),r?`${e}?${r}`:e},C=()=>`${s}/namespaces`,p=({namespace:e})=>`${s}/namespaces/${e}`,R=()=>`${s}/select-namespace`,U=e=>`${p(e)}/workflows`,E=e=>`${p(e)}/archival`,l=({workflow:e,run:r,...t})=>{const o=h(e);return`${U(t)}/${o}/${r}`},g=e=>`${p(e)}/schedules`,D=({namespace:e})=>`${g({namespace:e})}/create`,A=({scheduleId:e,namespace:r})=>{const t=h(e);return`${g({namespace:r})}/${t}`},L=({scheduleId:e,namespace:r})=>{const t=h(e);return`${g({namespace:r})}/${t}/edit`},N=({queryParams:e,...r})=>{const t=`${l(r)}/history`;return I(`${t}`,e)},_=e=>`${l(e)}/workers`,z=e=>{const r=h(e.queue);return`${p({namespace:e.namespace})}/task-queues/${r}`},O=e=>`${l(e)}/stack-trace`,T=e=>`${l(e)}/query`,W=e=>`${l(e)}/pending-activities`,q=e=>{const{settings:r,searchParams:t,originUrl:o}=e;switch(r.auth.flow){case d.AuthorizationCode:default:return S(r,t,o);case d.Implicit:return v(r,t,o)}},S=(e,r,t)=>{const o=new URL(`${s}/auth/sso`,e.baseUrl);let a=e.auth.options??[];return a=[...a,"returnUrl"],a.forEach(n=>{if(!r)return;const i=r.get(n);i&&o.searchParams.set(n,i)}),!o.searchParams.get("returnUrl")&&t&&o.searchParams.set("returnUrl",t),o.toString()},v=(e,r,t)=>{const o=new URL(e.auth.authorizationUrl);o.searchParams.set("response_type","id_token"),o.searchParams.set("client_id",e.auth.clientId),o.searchParams.set("redirect_uri",t),o.searchParams.set("scope",e.auth.scopes.join(" "));const a=crypto.randomUUID();window.localStorage.setItem("nonce",a),o.searchParams.set("nonce",a);const n=crypto.randomUUID();return sessionStorage.setItem(n,r.get("returnUrl")??(t||"/")),o.searchParams.set("state",n),o.toString()};class u extends Error{}class b extends u{}class f extends u{}const x=e=>{const r=new URLSearchParams(e.substring(1)),t=r.get("id_token");if(!t)return null;if(!window.localStorage.getItem("nonce"))throw new b("No nonce in localStorage");let a;try{a=F(t)}catch(m){throw m instanceof c?new u("Invalid id_token in hash"):new u(m)}const n=r.get("state");if(!n)throw new f("No state in hash");const i=sessionStorage.getItem(n);if(!i)throw new f("Hash state missing from sessionStorage");return{redirectUrl:i,authUser:{idToken:t,name:a.name,email:a.email},stateKey:n}},j=(e="",r=w)=>{if(r){const t=new URL(`${s}/login`,window.location.origin);return t.searchParams.set("returnUrl",window.location.href),e&&t.searchParams.set("error",e),t.toString()}return`${s}/login`},B=(e,r)=>e&&r?`${s}/import/events/${e}/workflow/run/history/${r}`:`${s}/import/events`;export{w as B,d as O,E as a,C as b,g as c,B as d,j as e,u as f,N as g,_ as h,W as i,O as j,T as k,y as l,x as m,R as n,z as o,p,A as q,U as r,D as s,I as t,L as u,q as v};
