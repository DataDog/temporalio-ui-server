import{w as k}from"./singletons.53e3d7de.js";import{g as S}from"./navigation.69a198e9.js";import{c as I,e as T}from"./schedule-service.ff56cb85.js";import{d as M,s as O}from"./route-for.31a507bb.js";const f=e=>e?parseInt(e):0,Q=(e,a,s,t)=>`${f(e)*60*60*24+f(a)*60*60+f(s)*60+f(t)}s`,W=({months:e=[],daysOfMonth:a=[],daysOfWeek:s=[]})=>{var c,n;const t=e.sort((o,l)=>parseInt(o)-parseInt(l)).join(","),r=a.sort((o,l)=>o-l).join(","),u=(((n=(c=s==null?void 0:s[0])==null?void 0:c.split(","))==null?void 0:n.length)>1?s[0].split(","):s).sort((o,l)=>parseInt(o)-parseInt(l)).join(",");return{month:t,dayOfMonth:r,dayOfWeek:u}},g=(e,a,s)=>{const{hour:t,minute:r,second:i,phase:u,cronString:c}=a,{preset:n,months:o,days:l,daysOfMonth:p,daysOfWeek:m}=s;if(n==="string"){const h=`${c}#${c}`;e.schedule.spec.cronString=[h],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(n==="interval"){const h=Q(l,t,r,i);e.schedule.spec.interval=[{interval:h,phase:u||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:h,dayOfMonth:v,dayOfWeek:y}=W({months:o,daysOfMonth:p,daysOfWeek:m});e.schedule.spec.calendar=[{year:"*",month:n==="month"?h:"",dayOfMonth:n==="month"?v:"",dayOfWeek:n==="week"?y:"",hour:t,minute:r,second:i}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}},x=async({action:e,spec:a,presets:s})=>{const{namespace:t,name:r,workflowId:i,workflowType:u,taskQueue:c}=e,n={schedule_id:r,schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:u},taskQueue:{name:c}}}}};g(n,a,s),d.set(!0);const{error:o}=await I({namespace:t,body:n});o?(w.set(o),d.set(!1)):setTimeout(()=>{w.set(""),d.set(!1),S(M({namespace:t}))},2e3)},z=async({action:e,spec:a,presets:s},t,r)=>{const{namespace:i,name:u,workflowId:c,workflowType:n,taskQueue:o}=e,{preset:l}=s,p={schedule_id:r,schedule:{...t,action:{startWorkflow:{...t.action.startWorkflow,workflowId:c,workflowType:{name:n},taskQueue:{name:o}}}}};l==="existing"?p.schedule.spec=t.spec:(g(p,a,s),p.schedule.spec.structuredCalendar=[]),d.set(!0);const{error:m}=await T({namespace:i,scheduleId:r,body:p});m?(w.set(m),d.set(!1)):setTimeout(()=>{S(O({namespace:i,scheduleId:u})),w.set(""),d.set(!1)},2e3)},d=k(!1),w=k("");export{x as a,w as e,d as l,z as s};
