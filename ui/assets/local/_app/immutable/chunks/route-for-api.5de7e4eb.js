import{B as f}from"./encode-uri.d223350b.js";import{g as A}from"./auth-user.03c2dec0.js";import{w as q}from"./singletons.53e3d7de.js";import{t as x}from"./toaster.61334268.js";import{h as I}from"./has.0120f47d.js";import{i as C}from"./is-network-error.85ce3eb2.js";import{r as $,t as R}from"./route-for.31a507bb.js";import{i as F}from"./persist-store.884e8244.js";import{ac as P}from"./index.9b814669.js";import{b as W}from"./paths.1b850ea8.js";import{p as O}from"./stores.8b6881b9.js";const S=q(null),N=(c,n=x,i=S,o=f)=>{throw typeof c=="string"?n.push({variant:"error",message:c}):c.report=!1,c instanceof Error&&n.push({variant:"error",message:c.message}),b(c)&&o&&window.location.assign($(c==null?void 0:c.message)),v(c)&&o&&window.location.assign($(c==null?void 0:c.message)),C(c)&&(n.push({variant:"error",message:`${c.statusCode} ${c.statusText}`}),i.set(c)),c},on=(c,n=f)=>{var o;const i=`${c==null?void 0:c.status} ${(o=c==null?void 0:c.body)==null?void 0:o.message}`;if(b(c)&&n){window.location.assign($(i));return}if(v(c)&&n){window.location.assign($(i));return}},b=c=>e(c,401),v=c=>e(c,403),e=(c,n)=>I(c,"statusCode")?c.statusCode===n:I(c,"status")?c.status===n:!1,sn=c=>(c==null?void 0:c.message)!==void 0&&typeof(c==null?void 0:c.message)=="string",un=async(c,n={})=>{const{params:i={},request:o=fetch,token:u,notifyOnError:l=!0,handleError:w=N,onError:k,isBrowser:g=f}=n;let{options:t}=n,h=new URLSearchParams;if(i!=null&&i.entries)h=i,u&&h.set("nextPageToken",u);else{const s=u?{next_page_token:u}:{};h=new URLSearchParams({...i,...s})}const T=R(c,h);try{t=_(t,g),c.endsWith("api/v1/settings")||(t=await z(t,g));const s=await o(T,t),d=await s.json(),{status:U,statusText:E}=s;if(!s.ok)if(k&&F(k))k({status:U,statusText:E,body:d});else throw{statusCode:s.status,statusText:s.statusText,response:s,message:(d==null?void 0:d.message)??s.statusText};return d}catch(s){if(l)w(s);else throw s}},_=(c,n=f)=>{const i={credentials:"include",...c};return i.headers=B(c==null?void 0:c.headers,n),i},z=async(c,n=f)=>{const{accessToken:i,idToken:o}=A();return globalThis!=null&&globalThis.AccessToken?c.headers=await y(c==null?void 0:c.headers,globalThis.AccessToken,n):(i||o)&&(c.headers=await y(c==null?void 0:c.headers,async()=>i??o,n)),o&&(c.headers=L(c==null?void 0:c.headers,o,n)),c},y=async(c,n,i=f)=>{if(c||(c={}),!i)return c;try{const o=await n();o&&(c.Authorization=`Bearer ${o}`)}catch(o){console.error(o)}return c},L=(c={},n,i=f)=>(i&&n&&(c["Authorization-Extras"]=n),c),B=(c,n=f)=>{if(c||(c={}),c["Caller-Type"]="operator",!n)return c;const i="_csrf=",o="X-CSRF-TOKEN";try{let l=document.cookie.split(";").find(w=>w.includes(i));l&&!c[o]&&(l=l.trim().slice(i.length),c[o]=l)}catch(u){console.error(u)}return c};function H(c=f){const n="",i=!n.startsWith("http");let o="";return i?o=c?window.location.origin+n:"":o=n,o.endsWith("/")&&(o=o.slice(0,-1)),o}const K=(c,n)=>c?c.replace("%namespace%",n):"",X=c=>{var l,w;let n="";const i=(l=P(O).data)==null?void 0:l.webUrl,o=i&&c,u=((w=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:w.apiUrl)&&c;return o?n=i:u?(console.warn("Using fallback api url, web url not found"),n=K(globalThis.AppConfig.apiUrl,c)):n=H(),n.endsWith("/")&&(n=n.slice(0,-1)),n=`${n}${W}`,n},D=c=>(c.startsWith("/")&&(c=c.slice(1)),`/api/v1/${c}`),G=(c,n)=>`${X(n)}${c}`,J=c=>Object.keys(c??{}).reduce((n,i)=>(n[i]=encodeURIComponent(encodeURIComponent(c[i])),n),{namespace:"",workflowId:"",scheduleId:"",runId:"",queue:"",activityId:""});function M(c,n,i=!0){i&&(n=J(n));const o={cluster:"/cluster",systemInfo:"/system-info","events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events/reverse`,namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/query`,"schedule.delete":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,"search-attributes":`/namespaces/${n.namespace}/search-attributes`,settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,"task-queue.compatibility":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/compatibility`,user:"/me","worker-task-reachability":`/namespaces/${n==null?void 0:n.namespace}/worker-task-reachability`,"workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/terminate`,"workflow.cancel":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/cancel`,"workflow.signal":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/signal`,"workflow.reset":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/reset`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/workflows/archived`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflows/count`,"activity.complete":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/activities/${n.activityId}/complete`,"activity.fail":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/activities/${n.activityId}/fail`,"batch-operations":`/namespaces/${n.namespace}/batch-operations`,"batch-operation.describe":`/namespaces/${n.namespace}/batch-operations/describe`};return D(o[c])}function ln(c,n,i=!0){const o=M(c,n,i);return G(o,n==null?void 0:n.namespace)}export{un as a,X as b,on as c,v as d,sn as e,H as g,N as h,b as i,S as n,M as p,ln as r};
